<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø± | Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø³Ø§Ù…ÙŠ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;800&display=swap" rel="stylesheet">
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <style>
        /* --- 1. Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø­Ø¯ÙŠØ« (Modern UI System) --- */
        :root {
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
            --accent-gold: #FFD700;
            --text-color: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html {
            width: 100%; height: 100%; margin: 0; padding: 0;
            overflow: hidden; font-family: 'Tajawal', sans-serif;
            background-color: #000; /* Ù„Ù…Ù†Ø¹ Ø§Ù„ÙˆÙ…ÙŠØ¶ Ø§Ù„Ø£Ø¨ÙŠØ¶ */
        }

        /* Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
        #arjs-video {
            width: 100% !important; height: 100% !important;
            object-fit: cover !important; position: absolute !important;
            top: 0; left: 0; z-index: 0 !important;
        }
        .a-canvas { z-index: 1 !important; }

        /* --- 2. Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØ§Ø®Ø±Ø© --- */
        #splash-screen {
            position: fixed; inset: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(20,20,20,0.9)), 
                        url('https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?q=80&w=1000');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: flex-end; /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
            padding: 40px; z-index: 9999; color: white;
            transition: opacity 0.6s ease-out;
        }

        .hero-title {
            font-size: 2.8rem; font-weight: 800; margin-bottom: 10px;
            background: linear-gradient(to right, #fff, var(--accent-gold));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        
        .hero-desc {
            font-size: 1.1rem; opacity: 0.8; margin-bottom: 40px; max-width: 300px; line-height: 1.6;
        }

        .start-btn {
            background: var(--accent-gold); color: #000;
            padding: 18px; border-radius: 20px; border: none;
            font-size: 1.2rem; font-weight: bold; width: 100%;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
            cursor: pointer; transition: transform 0.2s;
        }
        .start-btn:active { transform: scale(0.98); }

        /* --- 3. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨ (Glassmorphism HUD) --- */
        #hud-layer {
            position: fixed; inset: 0; z-index: 100;
            pointer-events: none; display: none;
            padding: 20px;
        }

        .glass-panel {
            background: var(--glass-bg); backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px; padding: 12px 20px;
            color: white; font-weight: bold; display: flex; align-items: center; gap: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            pointer-events: auto;
        }

        /* Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠ */
        .radar-container {
            width: 80px; height: 80px; border-radius: 50%;
            position: absolute; top: 20px; left: 20px;
            overflow: hidden; padding: 0; justify-content: center;
        }
        #radar-dot {
            width: 10px; height: 10px; background: #00ff88;
            border-radius: 50%; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            box-shadow: 0 0 10px #00ff88; border: 2px solid white;
        }

        /* Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø°Ù‡Ø¨ */
        .score-container {
            position: absolute; top: 20px; right: 20px;
        }

        /* Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ */
        .signature {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            font-size: 0.9rem; opacity: 0.7; letter-spacing: 1px;
            text-align: center; width: 100%;
        }
    </style>
</head>

<body>

    <div id="splash-screen">
        <div>
            <h1 class="hero-title">Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø±</h1>
            <p class="hero-desc">Ø§ÙƒØªØ´Ù Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ø°Ù‡Ø¨ ÙÙŠ ØªØ¬Ø±Ø¨Ø© ÙˆØ§Ù‚Ø¹ Ù…Ø¹Ø²Ø² ÙØ±ÙŠØ¯Ø©.</p>
        </div>
        <button class="start-btn" onclick="forceCameraStart()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© ğŸš€</button>
        <div style="text-align: center; margin-top: 15px; opacity: 0.5; font-size: 0.8rem;">Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±: Ù…. Ø³Ø§Ù…ÙŠ</div>
    </div>

    <div id="hud-layer">
        <div class="glass-panel radar-container">
            <div id="radar-dot"></div>
        </div>
        
        <div class="glass-panel score-container">
            <span style="font-size: 1.5rem;">ğŸ’</span>
            <span id="score-text">0</span>
        </div>

        <div class="signature">ØªØ·ÙˆÙŠØ±: Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø³Ø§Ù…ÙŠ</div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
        renderer="logarithmicDepthBuffer: true; precision: high; antialias: true; alpha: true;">
        
        <a-camera gps-camera rotation-reader minDistance="1" maxDistance="1500"></a-camera>
    </a-scene>

    <script>
        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© (GeoJSON) ---
        const pathCoords = [
            [56.92604, 23.28061], [56.92609, 23.2806], [56.92613, 23.28059], 
            [56.92620, 23.28058], [56.92625, 23.28057], [56.92631, 23.28056],
            [56.92634, 23.28052], [56.92639, 23.28048], [56.92644, 23.28045],
            [56.92649, 23.28043], [56.92654, 23.28043], [56.92660, 23.28042],
            [56.92670, 23.28041], [56.92688, 23.28036], [56.92698, 23.28032],
            [56.92706, 23.28027], [56.92713, 23.28024], [56.92781, 23.28017],
            [56.92825, 23.28005], [56.92899, 23.27985], [56.92970, 23.2796],
            [56.93030, 23.27927], [56.93149, 23.27887], [56.93247, 23.27845]
        ];

        let score = 0;

        // --- Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ© Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ---
        async function forceCameraStart() {
            try {
                // Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù‚Ø¨Ù„ Ø£ÙŠ Ø´ÙŠØ¡
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                
                // Ø¥Ø°Ø§ Ù†Ø¬Ø­Ù†Ø§ØŒ Ù†Ø¨Ø¯Ø£ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                startApp();
                
            } catch (err) {
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù„Ø¨Ø¯Ø¡.");
                console.error(err);
            }
        }

        function startApp() {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = '0';
            setTimeout(() => {
                splash.style.display = 'none';
                document.getElementById('hud-layer').style.display = 'block';
                initAR(); // Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³Ù…
                startGPS(); // Ø¨Ø¯Ø¡ Ø§Ù„ØªØªØ¨Ø¹
                speak("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø§Ø´Ù…Ù‡Ù†Ø¯Ø³ Ø³Ø§Ù…ÙŠ. Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„.");
            }, 600);
        }

        function initAR() {
            const scene = document.querySelector('a-scene');
            
            pathCoords.forEach((pt, i) => {
                const lng = pt[0];
                const lat = pt[1];

                // Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ (Ø§Ù„Ù…Ø³Ø§Ø±)
                const dot = document.createElement('a-entity');
                dot.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… geometry Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† sphere Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
                dot.setAttribute('geometry', 'primitive: sphere; radius: 0.5');
                dot.setAttribute('material', 'color: white; opacity: 0.9; shader: flat');
                scene.appendChild(dot);

                // Ø§Ù„Ø°Ù‡Ø¨ (Treasure)
                if (i % 6 === 0) {
                    const coin = document.createElement('a-entity');
                    coin.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
                    coin.innerHTML = `<a-octahedron radius="0.6" position="0 1.5 0" 
                        material="color: #FFD700; metalness: 1; roughness: 0; emissive: #FFD700; emissiveIntensity: 0.5"
                        animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-octahedron>`;
                    
                    coin.addEventListener('click', () => {
                        if(coin.getAttribute('visible') !== 'false') {
                            coin.setAttribute('visible', 'false');
                            score += 50;
                            document.getElementById('score-text').innerText = score;
                            speak("Ù…Ù…ØªØ§Ø²! Ù‚Ø·Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ©.");
                        }
                    });
                    scene.appendChild(coin);
                }
            });
        }

        function startGPS() {
            // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù…Ø´Ù‰ (Ù„Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ØµØºØ±Ø©)
            const bounds = { n: 23.2810, s: 23.2780, e: 56.9330, w: 56.9250 };
            
            navigator.geolocation.watchPosition(pos => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                
                // Ø­Ø³Ø§Ø¨ Ù…ÙƒØ§Ù† Ø§Ù„Ù†Ù‚Ø·Ø© ÙÙŠ Ø§Ù„Ø±Ø§Ø¯Ø§Ø±
                const y = ((bounds.n - lat) / (bounds.n - bounds.s)) * 100;
                const x = ((lng - bounds.w) / (bounds.e - bounds.w)) * 100;
                
                const dot = document.getElementById('radar-dot');
                dot.style.top = Math.min(Math.max(y, 10), 90) + '%';
                dot.style.left = Math.min(Math.max(x, 10), 90) + '%';
            }, null, { enableHighAccuracy: true });
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ar-SA';
                window.speechSynthesis.speak(u);
            }
        }
        
        // Ø¥ØµÙ„Ø§Ø­ Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        window.addEventListener('resize', () => {
            document.querySelector('a-scene').resize();
        });
    </script>
</body>
</html>
