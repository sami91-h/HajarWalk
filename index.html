<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠ | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <style>
        /* --- 1. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØµÙ…ÙŠÙ… (Design System) --- */
        :root {
            --gold-glow: #FFD700;
            --glass-bg: rgba(20, 20, 20, 0.4);
            --glass-border: rgba(255, 215, 0, 0.3);
            --neon-green: #00ff88;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: #000; font-family: 'Tajawal', sans-serif;
        }

        /* Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„ÙŠÙ…Ù„Ø£ Ø§Ù„Ø´Ø§Ø´Ø© ÙƒØ§Ù„Ø®Ù„ÙÙŠØ© */
        #arjs-video {
            width: 100% !important; height: 100% !important;
            object-fit: cover !important; position: absolute !important;
            top: 0; left: 0; z-index: 0 !important;
        }
        
        /* Ø·Ø¨Ù‚Ø© Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ */
        .a-canvas { z-index: 1 !important; position: absolute !important; }

        /* --- 2. Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠØ© --- */
        #splash-screen {
            position: fixed; inset: 0;
            /* Ø®Ù„ÙÙŠØ© Ù…Ø³ØªÙˆØ­Ø§Ø© Ù…Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ: Ø·Ø¨ÙŠØ¹Ø© Ù…Ø¹ Ù„Ù…Ø³Ø© ØªÙ‚Ù†ÙŠØ© */
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.9)), 
                        url('https://images.unsplash.com/photo-1518531933037-91b2f5f229cc?q=80&w=1000');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: flex-end;
            padding: 30px; z-index: 9999; color: white;
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hero-content { margin-bottom: 40px; animation: slideUp 1s ease-out; }
        
        h1 {
            font-size: 3rem; font-weight: 800; margin: 0;
            background: linear-gradient(45deg, #fff, var(--gold-glow));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        p.subtitle {
            font-size: 1.1rem; color: rgba(255,255,255,0.8); margin-top: 10px; max-width: 300px;
        }

        /* Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…ØªÙˆÙ‡Ø¬ */
        .start-btn {
            background: rgba(255, 215, 0, 0.9);
            color: #000; border: none; padding: 18px; width: 100%;
            border-radius: 24px; font-size: 1.3rem; font-weight: 800;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
            cursor: pointer; position: relative; overflow: hidden;
            transition: transform 0.2s;
        }
        .start-btn::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shine 3s infinite;
        }
        .start-btn:active { transform: scale(0.96); }

        /* --- 3. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨ (HUD) Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© --- */
        #hud-layer {
            position: fixed; inset: 0; pointer-events: none; z-index: 100;
            display: none; padding: 20px;
        }

        .glass-panel {
            background: var(--glass-bg); backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px; color: white;
            pointer-events: auto; display: flex; align-items: center; justify-content: center;
        }

        /* Ø§Ù„Ø±Ø§Ø¯Ø§Ø± */
        .radar-box {
            position: absolute; top: 20px; left: 20px;
            width: 80px; height: 80px; border-radius: 50%;
        }
        #radar-dot {
            width: 10px; height: 10px; background: var(--neon-green);
            border-radius: 50%; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); box-shadow: 0 0 10px var(--neon-green);
            border: 2px solid white; transition: all 0.2s;
        }

        /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ */
        .score-box {
            position: absolute; top: 20px; right: 20px;
            padding: 10px 20px; gap: 10px; font-weight: 800; font-size: 1.1rem;
        }
        .gold-icon { font-size: 1.4rem; animation: float 3s infinite ease-in-out; }

        /* Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ */
        .footer {
            position: absolute; bottom: 30px; width: 100%; left: 0;
            text-align: center; font-size: 0.8rem; opacity: 0.6; letter-spacing: 1px;
        }

        /* --- Animations --- */
        @keyframes shine { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>

<body>

    <div id="splash-screen">
        <div class="hero-content">
            <h1>Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø±</h1>
            <p class="subtitle">ØªØ¬Ø±Ø¨Ø© Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø² | Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ</p>
        </div>
        <button class="start-btn" onclick="initializeExperience()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© ğŸš€</button>
        <div style="text-align: center; margin-top: 15px; opacity: 0.5; font-size: 0.8rem;">Developed by Eng. Sami</div>
    </div>

    <div id="hud-layer">
        <div class="glass-panel radar-box">
            <div id="radar-dot"></div>
        </div>
        
        <div class="glass-panel score-box">
            <span class="gold-icon">ğŸ’</span>
            <span id="score-text">0</span>
        </div>

        <div class="footer">Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø±</div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
        renderer="logarithmicDepthBuffer: true; precision: high; antialias: true; alpha: true;">
        
        <a-camera gps-camera rotation-reader minDistance="1" maxDistance="2000"></a-camera>
    </a-scene>

    <script>
        // --- 1. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© (GeoJSON Data) ---
        // ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Ù…Ù„ÙÙƒ ÙˆØ¯Ù…Ø¬Ù‡Ø§ Ù‡Ù†Ø§
        const pathData = [
            [56.92604, 23.28061], [56.92609, 23.2806], [56.92613, 23.28059], 
            [56.92620, 23.28058], [56.92625, 23.28057], [56.92631, 23.28056],
            [56.92634, 23.28052], [56.92639, 23.28048], [56.92644, 23.28045],
            [56.92649, 23.28043], [56.92654, 23.28043], [56.92660, 23.28042],
            [56.92670, 23.28041], [56.92688, 23.28036], [56.92698, 23.28032],
            [56.92706, 23.28027], [56.92713, 23.28024], [56.92781, 23.28017],
            [56.92825, 23.28005], [56.92899, 23.27985], [56.92970, 23.2796],
            [56.93030, 23.27927], [56.93149, 23.27887], [56.93247, 23.27845]
        ];

        let score = 0;

        // --- 2. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ---
        async function initializeExperience() {
            // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¹Ù…Ù„
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                
                // ØªØ­Ø±ÙŠÙƒ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ø£Ø¹Ù„Ù‰ (Animation)
                const splash = document.getElementById('splash-screen');
                splash.style.transform = 'translateY(-100%)';
                
                setTimeout(() => {
                    splash.style.display = 'none';
                    document.getElementById('hud-layer').style.display = 'block';
                    
                    // Ø¨Ø¯Ø¡ Ø§Ù„Ø±Ø³Ù… ÙˆØ§Ù„ØªØªØ¨Ø¹
                    renderARObjects();
                    startGPSRadar();
                    playSound("start"); // ØµÙˆØª ØªØ±Ø­ÙŠØ¨ÙŠ
                }, 800);
                
            } catch (err) {
                alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ Ù„Ù„Ø§Ø³ØªÙ…ØªØ§Ø¹ Ø¨Ø§Ù„ØªØ¬Ø±Ø¨Ø©.");
            }
        }

        // --- 3. Ø±Ø³Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø² ---
        function renderARObjects() {
            const scene = document.querySelector('a-scene');
            
            pathData.forEach((pt, i) => {
                const lng = pt[0];
                const lat = pt[1];

                // Ø£) Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø± (ÙƒØ±Ø§Øª Ø¨ÙŠØ¶Ø§Ø¡ Ù…ØªÙˆÙ‡Ø¬Ø©)
                const pathDot = document.createElement('a-entity');
                pathDot.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… primitive Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬
                pathDot.setAttribute('geometry', 'primitive: sphere; radius: 0.5');
                pathDot.setAttribute('material', 'color: white; opacity: 0.8; shader: flat');
                scene.appendChild(pathDot);

                // Ø¨) Ø§Ù„Ø°Ù‡Ø¨ (ÙƒÙ„ 5 Ù†Ù‚Ø§Ø·)
                if (i % 5 === 0) {
                    const treasure = document.createElement('a-entity');
                    treasure.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
                    // Ø´ÙƒÙ„ Ø£Ù„Ù…Ø§Ø³ Ø°Ù‡Ø¨ÙŠ ÙŠØ¯ÙˆØ±
                    treasure.innerHTML = `
                        <a-entity position="0 1.5 0" 
                            animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear">
                            <a-octahedron radius="0.7" material="color: #FFD700; metalness: 0.9; roughness: 0.1; emissive: #FFD700; emissiveIntensity: 0.3"></a-octahedron>
                        </a-entity>
                    `;
                    
                    // Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³
                    treasure.addEventListener('click', () => {
                        if(treasure.getAttribute('visible') !== 'false') {
                            treasure.setAttribute('visible', 'false'); // Ø¥Ø®ÙØ§Ø¡
                            updateScore(50);
                        }
                    });
                    scene.appendChild(treasure);
                }
            });
        }

        // --- 4. Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ ---
        function startGPSRadar() {
            // Ø­Ø¯ÙˆØ¯ ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ù†Ø·Ù‚Ø© (Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ù‚Ø·Ø© ÙÙŠ Ø§Ù„Ø±Ø§Ø¯Ø§Ø±)
            const bounds = { n: 23.2810, s: 23.2780, e: 56.9330, w: 56.9250 };
            
            navigator.geolocation.watchPosition(pos => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                
                // Ù…Ø¹Ø§Ø¯Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø¥Ù„Ù‰ Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ© CSS
                const y = ((bounds.n - lat) / (bounds.n - bounds.s)) * 100;
                const x = ((lng - bounds.w) / (bounds.e - bounds.w)) * 100;
                
                const dot = document.getElementById('radar-dot');
                // ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© (Clamping)
                dot.style.top = Math.min(Math.max(y, 10), 90) + '%';
                dot.style.left = Math.min(Math.max(x, 10), 90) + '%';
                
            }, null, { enableHighAccuracy: true });
        }

        // --- 5. Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„ØµÙˆØª ---
        function updateScore(points) {
            score += points;
            const scoreEl = document.getElementById('score-text');
            
            // ØªØ£Ø«ÙŠØ± Ø¹Ø¯Ù‘Ø§Ø¯ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
            scoreEl.style.transform = "scale(1.5)";
            scoreEl.style.color = "#00ff88";
            setTimeout(() => {
                scoreEl.innerText = score;
                scoreEl.style.transform = "scale(1)";
                scoreEl.style.color = "white";
            }, 200);
            
            playSound("coin");
        }

        function playSound(type) {
            if ('speechSynthesis' in window) {
                const text = type === "start" ? "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø±. Ø§ØªØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠØ¡." : "Ø£Ø­Ø³Ù†Øª! Ù‚Ø·Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ©.";
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ar-SA';
                window.speechSynthesis.speak(u);
            }
        }
        
        // --- 6. Ø¥ØµÙ„Ø§Ø­ ØªÙ‚Ù†ÙŠ Ù†Ù‡Ø§Ø¦ÙŠ ---
        // ÙŠØ¶Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… Ø§Ù„Ù…Ø´Ù‡Ø¯ Ø¹Ù†Ø¯ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø¬ÙˆØ§Ù„
        window.addEventListener('resize', () => {
            const scene = document.querySelector('a-scene');
            if(scene) scene.resize();
        });
    </script>
</body>
</html>
