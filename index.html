<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠ | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø«Ø§Ø¨Øª</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <style>
        /* --- Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª: Ø´ÙØ§ÙÙŠØ© Ù…Ø·Ù„Ù‚Ø© Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ --- */
        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: 'Cairo', sans-serif;
            background-color: transparent !important; /* Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³ÙˆØ¯ */
            overflow: hidden;
        }

        /* --- Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ (Z-Index Stack) --- */
        /* 1. Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹) */
        #arjs-video {
            position: fixed !important; top: 0; left: 0;
            width: 100% !important; height: 100% !important;
            z-index: -2 !important; object-fit: cover !important;
            display: block !important;
        }
        
        /* 2. Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ (ÙÙˆÙ‚ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§) */
        .a-canvas {
            position: fixed !important; top: 0; left: 0;
            z-index: -1 !important;
        }

        /* 3. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙÙˆÙ‚ Ø§Ù„Ø¬Ù…ÙŠØ¹) */
        #ui-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 100; pointer-events: none; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ù„Ù…Ø³ Ø¹Ø¨Ø± Ø§Ù„ÙØ±Ø§ØºØ§Øª */
        }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,30,0,0.9), rgba(0,0,0,0.95)), url('https://images.unsplash.com/photo-1545231027-637d2f6210f8?w=800');
            background-size: cover; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 999;
            color: #DAA520; text-align: center; padding: 20px;
            pointer-events: auto; transition: opacity 0.5s;
        }

        .gold-text { color: #DAA520; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        .white-text { color: #f0f0f0; font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px; }

        .start-btn {
            background: linear-gradient(45deg, #DAA520, #F0E68C);
            color: #000; border: none; padding: 15px 60px;
            border-radius: 50px; font-weight: bold; font-size: 1.2rem;
            cursor: pointer; box-shadow: 0 0 20px rgba(218, 165, 32, 0.5);
            font-family: 'Cairo', sans-serif;
        }

        /* --- Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ --- */
        .dev-signature {
            position: absolute; bottom: 20px;
            font-size: 0.9rem; color: #DAA520; opacity: 0.8;
            border-top: 1px solid #DAA520; padding-top: 10px; width: 80%;
        }

        /* --- Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙˆØ¹Ø¯Ø§Ø¯ Ø§Ù„Ø°Ù‡Ø¨ --- */
        .hud-item {
            position: absolute; background: rgba(0, 20, 0, 0.6);
            border: 1px solid #DAA520; backdrop-filter: blur(4px);
            border-radius: 15px; pointer-events: auto;
        }
        
        #score-box { top: 20px; left: 20px; padding: 8px 15px; color: #DAA520; font-weight: bold; }
        
        #radar {
            top: 20px; right: 20px; width: 100px; height: 100px;
            border-radius: 50%; overflow: hidden; background: rgba(0,0,0,0.5);
        }
        #radar-dot {
            width: 8px; height: 8px; background: red; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            box-shadow: 0 0 5px white;
        }

        /* --- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ (Ù„Ù„ØªØ´Ø®ÙŠØµ) --- */
        #debug-console {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: rgba(255,0,0,0.8); color: white; 
            padding: 10px; font-size: 12px; display: none; z-index: 2000;
        }
    </style>
</head>

<body>

    <div id="splash-screen">
        <h1 class="gold-text" style="font-size: 2.5rem;">Ù…Ù…Ø´Ù‰ Ø¨Ù„Ø¯Ø© Ø§Ù„Ù‡Ø¬Ø±</h1>
        <p class="white-text" style="max-width: 500px;">
            ØªØ¬Ø±Ø¨Ø© Ø³ÙŠØ§Ø­ÙŠØ© ØªÙØ§Ø¹Ù„ÙŠØ© ØªÙ…Ø²Ø¬ Ø¨ÙŠÙ† Ø¹Ø±Ø§Ù‚Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠ ÙˆØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„.
            <br>Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ø³Ø§Ø±ØŒ ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„ÙƒÙ†ÙˆØ².
        </p>
        
        <button class="start-btn" onclick="startExperience()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
        
        <div class="dev-signature">
            ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø³Ø§Ù…ÙŠ
        </div>
    </div>

    <div id="ui-layer" style="display:none;">
        <div id="score-box" class="hud-item">ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: <span id="score">0</span></div>
        <div id="radar" class="hud-item"><div id="radar-dot"></div></div>
    </div>

    <div id="debug-console"></div>

    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
        renderer="logarithmicDepthBuffer: true; precision: medium; alpha: true;">
        
        <a-camera gps-camera rotation-reader minDistance="5" maxDistance="1000">
        </a-camera>
        
        <a-entity id="test-sphere" position="0 0 -5" geometry="primitive: sphere; radius: 0.5" material="color: red"></a-entity>

    </a-scene>

    <script>
        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        const pathPoints = [
            {lat: 23.280610, lng: 56.926040}, {lat: 23.280598, lng: 56.926108},
            {lat: 23.280586, lng: 56.926203}, {lat: 23.280566, lng: 56.926310},
            {lat: 23.280526, lng: 56.926345}, {lat: 23.280486, lng: 56.926390},
            {lat: 23.280431, lng: 56.926496}, {lat: 23.280436, lng: 56.926543},
            {lat: 23.280426, lng: 56.926606}, {lat: 23.280415, lng: 56.926705}
        ];
        const bounds = { n: 23.2810, s: 23.2780, e: 56.9330, w: 56.9250 };
        
        let score = 0;

        function logError(msg) {
            const consoleDiv = document.getElementById('debug-console');
            consoleDiv.style.display = 'block';
            consoleDiv.innerText = "ØªÙ†Ø¨ÙŠÙ‡: " + msg;
        }

        function startExperience() {
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = '0';
            setTimeout(() => { splash.style.display = 'none'; }, 500);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            document.getElementById('ui-layer').style.display = 'block';
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´Ù‡Ø¯
            initScene();
            
            // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª (ÙŠØ­ØªØ§Ø¬ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
            speak("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø±. Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†ØŒ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø°Ù‡Ø¨.");
        }

        function initScene() {
            const scene = document.querySelector('a-scene');
            
            // Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø±
            pathPoints.forEach((pt, i) => {
                const dot = document.createElement('a-entity');
                dot.setAttribute('gps-entity-place', `latitude: ${pt.lat}; longitude: ${pt.lng};`);
                dot.innerHTML = `<a-sphere radius="0.5" color="#DAA520" material="emissive: #DAA520; emissiveIntensity: 2"></a-sphere>`;
                scene.appendChild(dot);
                
                // Ø¥Ø¶Ø§ÙØ© Ù‚Ø·Ø¹ Ø°Ù‡Ø¨ÙŠØ© Ù„Ù„Ø¬Ù…Ø¹
                if (i % 2 === 0) {
                    const coin = document.createElement('a-entity');
                    coin.setAttribute('gps-entity-place', `latitude: ${pt.lat + 0.00002}; longitude: ${pt.lng};`);
                    coin.innerHTML = `<a-octahedron radius="0.3" color="#FFD700" animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-octahedron>`;
                    coin.addEventListener('click', () => {
                        coin.setAttribute('visible', 'false');
                        score += 10;
                        document.getElementById('score').innerText = score;
                        speak("Ø¬Ù…ÙŠÙ„! ÙˆØ¬Ø¯Øª Ù‚Ø·Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ©");
                    });
                    scene.appendChild(coin);
                }
            });

            // Ø¨Ø¯Ø¡ ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹
            navigator.geolocation.watchPosition(updateRadar, 
                (err) => logError("ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ GPS."), 
                { enableHighAccuracy: true, maximumAge: 0 }
            );
        }

        function updateRadar(pos) {
            const { latitude, longitude } = pos.coords;
            const y = ((bounds.n - latitude) / (bounds.n - bounds.s)) * 100;
            const x = ((longitude - bounds.w) / (bounds.e - bounds.w)) * 100;
            const dot = document.getElementById('radar-dot');
            dot.style.top = Math.min(Math.max(y, 5), 95) + '%';
            dot.style.left = Math.min(Math.max(x, 5), 95) + '%';
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ar-SA';
                window.speechSynthesis.speak(u);
            }
        }

        // --- Ø¥ØµÙ„Ø§Ø­ Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ---
        // Ù†ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ£Ø®Ø° Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø© ÙˆÙ„Ø§ ÙŠØ®ØªÙÙŠ
        window.addEventListener('arjs-video-loaded', (e) => {
            const video = document.getElementById('arjs-video');
            if (video) {
                video.style.zIndex = "-2"; 
                video.style.display = "block";
            }
        });
    </script>
</body>
</html>
