<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠ | Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø³Ø§Ù…ÙŠ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <style>
        /* --- Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… --- */
        :root {
            --gold: #DAA520;
            --dark-green: #004d00;
            --bg-overlay: rgba(0, 0, 0, 0.85);
        }
        
        body, html {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            font-family: 'Cairo', sans-serif;
            overflow: hidden; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ */
            background-color: #000;
        }

        /* --- Ø¥ØµÙ„Ø§Ø­ Ø¬Ø°Ø±ÙŠ Ù„Ø·Ø¨Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§) --- */
        .a-canvas {
            position: fixed !important;
            top: 0; left: 0;
            z-index: 0 !important; /* Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© */
        }

        /* --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØ®Ù…Ø© (Start Screen) --- */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, var(--dark-green), var(--bg-overlay)), url('https://images.unsplash.com/photo-1545231027-637d2f6210f8?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; color: white; padding: 20px; box-sizing: border-box;
            z-index: 9999; /* ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡ */
            transition: opacity 0.8s ease-out;
        }

        #start-screen h1 {
            font-size: 2.5rem; margin-bottom: 10px; color: var(--gold);
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        .intro-text {
            font-size: 1.1rem; line-height: 1.6; max-width: 500px; margin-bottom: 30px;
            color: #e0e0e0;
        }

        .signature-box {
            margin-top: 20px; padding: 10px 20px;
            border-right: 4px solid var(--gold);
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        .signature {
            font-size: 0.9rem; color: var(--gold); font-weight: bold;
        }

        /* Ø²Ø± Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
        .gold-btn {
            background: linear-gradient(45deg, var(--gold), #FFD700);
            color: #000; border: none; padding: 15px 50px;
            border-radius: 50px; font-size: 1.2rem; font-weight: bold;
            cursor: pointer; box-shadow: 0 5px 15px rgba(218, 165, 32, 0.4);
            transition: transform 0.2s;
            font-family: 'Cairo', sans-serif;
        }
        .gold-btn:active { transform: scale(0.95); }

        /* --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨ (In-Game UI) --- */
        #game-ui {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ù„Ù…Ø³ Ù…Ù† Ø®Ù„Ø§Ù„Ù‡ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
            z-index: 100; display: none; /* Ù…Ø®ÙÙŠ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        }

        .stats-card {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px); /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ */
            padding: 10px 20px; border-radius: 15px;
            border: 1px solid var(--gold); color: var(--gold);
            font-weight: bold; display: flex; align-items: center; gap: 10px;
        }

        /* Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù† */
        #radar-container {
            position: absolute; top: 20px; right: 20px;
            width: 110px; height: 110px;
            background: rgba(0, 50, 0, 0.7);
            border: 2px solid var(--gold);
            border-radius: 50%; overflow: hidden;
            box-shadow: 0 0 10px rgba(218, 165, 32, 0.3);
        }
        #user-dot {
            position: absolute; width: 12px; height: 12px; background: red;
            border-radius: 50%; transform: translate(-50%, -50%);
            top: 50%; left: 50%; border: 2px solid white; box-shadow: 0 0 5px red;
        }
    </style>
</head>

<body>

    <div id="start-screen">
        <h1>Ù…Ù…Ø´Ù‰ Ø¨Ù„Ø¯Ø© Ø§Ù„Ù‡Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠ</h1>
        <div class="intro-text">
            Ø­ÙŠØ« ÙŠØªØ¹Ø§Ù†Ù‚ Ø¹Ø¨Ù‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ø¹ Ø³Ø­Ø± Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§. Ø§Ø³ØªÙƒØ´Ù Ø¬Ù…Ø§Ù„ Ù…Ø²Ø§Ø±Ø¹Ù†Ø§ Ø§Ù„Ø¹Ø±ÙŠÙ‚Ø©ØŒ ÙˆØªØªØ¨Ø¹ Ù…Ø³Ø§Ø± Ø§Ù„Ø£ÙÙ„Ø§Ø¬ØŒ ÙˆØ§Ø¬Ù…Ø¹ ÙƒÙ†ÙˆØ² Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙÙŠ Ø±Ø­Ù„Ø© Ù„Ø§ ØªÙÙ†Ø³Ù‰ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø¹Ø²Ø².
        </div>
        
        <button class="gold-btn" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© Ø§Ù„Ø¢Ù† ğŸš€</button>
        
        <div class="signature-box">
            <div class="signature">ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø³Ø§Ù…ÙŠ</div>
        </div>
    </div>

    <div id="game-ui">
        <div class="stats-card">
            <span>ğŸ’°</span> <span id="score-text">Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0</span>
        </div>
        <div id="radar-container">
            <div id="user-dot"></div>
        </div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium; antialias: false;"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;">
        
        <a-camera gps-camera rotation-reader minDistance="5" maxDistance="1500"></a-camera>
    </a-scene>

    <script>
        // --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø± ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ (Ù…Ù† Ù…Ù„ÙÙƒ GPX) ---
        const pathPoints = [
            {lat: 23.280610, lng: 56.926040}, {lat: 23.280598, lng: 56.926108},
            {lat: 23.280586, lng: 56.926203}, {lat: 23.280566, lng: 56.926310},
            {lat: 23.280431, lng: 56.926496}, {lat: 23.280415, lng: 56.926705},
            {lat: 23.280320, lng: 56.926988}, {lat: 23.280170, lng: 56.927818},
            {lat: 23.279850, lng: 56.928990}, {lat: 23.278870, lng: 56.931495}
        ];
        const bounds = { n: 23.2810, s: 23.2780, e: 56.9330, w: 56.9250 };

        let score = 0;
        let gameState = 'waiting'; // waiting, playing

        // --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø¯Ø¡ Ø¹Ù†Ø¯ Ø¶ØºØ· Ø§Ù„Ø²Ø± ---
        function startGame() {
            if (gameState === 'playing') return;
            gameState = 'playing';

            // 1. Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨ØªØ£Ø«ÙŠØ± Ø³Ù„Ø³
            const startScreen = document.getElementById('start-screen');
            startScreen.style.opacity = '0';
            setTimeout(() => {
                startScreen.style.display = 'none';
                // 2. Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
                document.getElementById('game-ui').style.display = 'block';
            }, 800);

            // 3. ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠ
            speak("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø§Ø´Ù…Ù‡Ù†Ø¯Ø³ Ø³Ø§Ù…ÙŠ ÙˆØ²ÙˆØ§Ø±Ùƒ Ø§Ù„ÙƒØ±Ø§Ù… ÙÙŠ Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø±. Ø§ØªØ¨Ø¹ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ.");

            // 4. ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù€ AR Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            setTimeout(() => {
                initARScene();
                startGPSMaps();
            }, 1000);
        }

        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´Ù‡Ø¯ (Ø±Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø± ÙˆØ§Ù„Ø°Ù‡Ø¨) ---
        function initARScene() {
            const scene = document.querySelector('a-scene');
            
            pathPoints.forEach((pt, i) => {
                // Ø±Ø³Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø³Ø§Ø± (ÙƒØ±Ø§Øª Ø°Ù‡Ø¨ÙŠØ© ØµØºÙŠØ±Ø©)
                const dot = document.createElement('a-entity');
                dot.setAttribute('gps-entity-place', `latitude: ${pt.lat}; longitude: ${pt.lng};`);
                dot.innerHTML = `<a-sphere radius="0.2" color="#DAA520" material="emissive: #DAA520; emissiveIntensity: 1.5"></a-sphere>`;
                scene.appendChild(dot);

                // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ø°Ù‡Ø¨ Ù„Ù„Ø¬Ù…Ø¹ ÙƒÙ„ 3 Ù†Ù‚Ø§Ø·
                if (i % 3 === 0) {
                    const coin = document.createElement('a-entity');
                    coin.setAttribute('gps-entity-place', `latitude: ${pt.lat + 0.00003}; longitude: ${pt.lng};`);
                    // Ø´ÙƒÙ„ Ù‡Ù†Ø¯Ø³ÙŠ Ù…ØªÙ„Ø£Ù„Ø¦ ÙŠØ¯ÙˆØ±
                    coin.innerHTML = `<a-octahedron radius="0.4" color="#FFD700" animation="property: rotation; to: 0 360 0; loop: true; dur: 2500" material="metalness: 1; roughness: 0.2;"></a-octahedron>`;
                    
                    // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„ (Ø§Ù„Ù†Ù‚Ø± Ù„Ù„Ø¬Ù…Ø¹)
                    coin.addEventListener('click', function() {
                        if (this.getAttribute('visible') !== false) {
                            this.setAttribute('visible', 'false');
                            score += 50;
                            document.getElementById('score-text').innerText = "Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: " + score;
                            speak("Ø£Ø­Ø³Ù†Øª! Ù„Ù‚Ø¯ Ø¬Ù…Ø¹Øª Ù‚Ø·Ø¹Ø© Ø°Ù‡Ø¨ÙŠØ©.");
                        }
                    });
                    scene.appendChild(coin);
                }
            });
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø§Ø¯Ø§Ø± ÙˆØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ---
        function startGPSMaps() {
            navigator.geolocation.watchPosition(pos => {
                const { latitude, longitude } = pos.coords;
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø¯ÙˆØ¯
                const y = ((bounds.n - latitude) / (bounds.n - bounds.s)) * 100;
                const x = ((longitude - bounds.w) / (bounds.e - bounds.w)) * 100;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¯Ø§Ø± (Ù…Ø¹ ØªÙ‚ÙŠÙŠØ¯Ù‡Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©)
                const dot = document.getElementById('user-dot');
                dot.style.top = Math.min(Math.max(y, 5), 95) + '%';
                dot.style.left = Math.min(Math.max(x, 5), 95) + '%';
            }, null, { enableHighAccuracy: true, maximumAge: 0 });
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙˆØª ---
        function speak(text) {
            if ('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ar-SA'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }

        // --- Ø¥ØµÙ„Ø§Ø­ Ø£Ø®ÙŠØ± Ù„Ø¶Ù…Ø§Ù† Ø«Ø¨Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ¯ÙˆÙŠØ± ---
        window.addEventListener('resize', () => {
            document.querySelector('a-scene').resize();
        });
    </script>
</body>
</html>
