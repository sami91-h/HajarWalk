<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title> Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø± | Ø§Ø¹Ø¯Ø§Ø¯:Ø³Ø§Ù…ÙŠ Ø§Ù„Ø³Ù…Ø±ÙŠ</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <style>
        /* --- 1. Ø¥ØµÙ„Ø§Ø­ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø´Ø§Ø´Ø© (Full Screen Fix) --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ */
            font-family: 'Tajawal', sans-serif;
            background-color: black; /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
        }

        /* Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù„Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© ÙˆØªØµØ­ÙŠØ­ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ */
        #arjs-video {
            width: 100vw !important; height: 100vh !important;
            object-fit: cover !important; /* ØªØºØ·ÙŠØ© ÙƒØ§Ù…Ù„Ø© Ø¨Ø¯ÙˆÙ† ÙØ±Ø§ØºØ§Øª */
            position: absolute !important; top: 0; left: 0;
            z-index: 0 !important;
            transform: none !important; /* Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ ØªØ¯ÙˆÙŠØ± Ø®Ø§Ø·Ø¦ Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø© */
        }

        /* --- 2. Ø·Ø¨Ù‚Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (UI Layer) --- */
        /* Ù†Ø³ØªØ®Ø¯Ù… inset:0 Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ù„ØªØµØ§Ù‚ Ø¨Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© */
        #ui-layer {
            position: fixed; inset: 0;
            z-index: 100; pointer-events: none; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ù„Ù…Ø³ Ø¹Ø¨Ø±Ù‡ */
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        #splash {
            position: fixed; inset: 0;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.9)), url('https://images.unsplash.com/photo-1578895210405-927f05f3c8b0?w=1000');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; z-index: 9999; text-align: center;
            transition: opacity 0.5s; pointer-events: auto;
        }

        .btn {
            padding: 15px 50px; background: white; color: black;
            border: none; border-radius: 50px; font-weight: bold; font-size: 1.1rem;
            margin-top: 30px; cursor: pointer; box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        /* Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¹Ù„ÙˆÙŠØ© (Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø±Ø§Ø¯Ø§Ø±) */
        .top-bar {
            padding: 20px; display: flex; justify-content: space-between; align-items: flex-start;
        }

        .hud-box {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            padding: 10px 20px; border-radius: 20px;
            color: white; font-weight: bold; border: 1px solid rgba(255,255,255,0.3);
            pointer-events: auto;
        }

        #radar {
            width: 80px; height: 80px; border-radius: 50%;
            background: rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.5);
            position: relative; overflow: hidden; pointer-events: auto;
        }
        #radar-dot {
            width: 8px; height: 8px; background: #00FF00; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            box-shadow: 0 0 5px #00FF00; border: 2px solid white;
        }

        /* Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ */
        .bottom-bar {
            padding: 20px; text-align: center;
        }
        .signature {
            display: inline-block; background: rgba(0,0,0,0.5);
            padding: 5px 15px; border-radius: 20px;
            color: rgba(255,255,255,0.8); font-size: 0.8rem;
            pointer-events: auto;
        }
    </style>
</head>

<body>

    <div id="splash">
        <h1 style="font-size: 2.5rem; margin-bottom: 5px;">Ù…Ù…Ø´Ù‰ Ø¨Ù„Ø¯Ø© Ø§Ù„Ù‡Ø¬Ø±</h1>
        <p style="font-size: 1.1rem; opacity: 0.9;">Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ</p>
        <button class="btn" onclick="startApp()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø© ğŸš€</button>
    </div>

    <div id="ui-layer">
        <div class="top-bar">
            <div id="radar">
                <div id="radar-dot"></div>
            </div>
            <div class="hud-box">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
        </div>
        
        <div class="bottom-bar">
            <div class="signature">ØªØ·ÙˆÙŠØ±:  Ø³Ø§Ù…ÙŠ Ø§Ù„Ø³Ù…Ø±ÙŠ</div>
        </div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
        renderer="logarithmicDepthBuffer: true; precision: high; antialias: true; alpha: true;">
        
        <a-camera gps-camera rotation-reader minDistance="1" maxDistance="1500"></a-camera>
    </a-scene>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© (Ù…Ù† Ù…Ù„Ù GeoJSON Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ)
        const trackCoordinates = [
            [56.92604, 23.28061], [56.926055, 23.28060667], [56.92609667, 23.2806],
            [56.92610833, 23.28059833], [56.92613833, 23.280595], [56.92616333, 23.28059333],
            [56.926185, 23.28059], [56.92620333, 23.28058667], [56.926225, 23.28058667],
            [56.92623667, 23.28058333], [56.92625833, 23.28057333], [56.92627833, 23.28056833],
            [56.92631, 23.28056667], [56.92632333, 23.28055667], [56.926345, 23.28052667],
            [56.92635667, 23.28051], [56.92639, 23.28048667], [56.92641, 23.280475],
            [56.92644167, 23.28045667], [56.92646667, 23.280445], [56.92649667, 23.28043167],
            [56.92652167, 23.28043167], [56.92654333, 23.28043667], [56.92657333, 23.28043667],
            [56.92660667, 23.28042667], [56.92663167, 23.280425], [56.92666333, 23.28042333],
            [56.926705, 23.280415], [56.92688333, 23.28036833], [56.92698833, 23.28032],
            [56.92706, 23.28027833], [56.92713333, 23.28024833], [56.92781833, 23.28017],
            [56.92825333, 23.28005], [56.92899, 23.27985], [56.92970333, 23.2796],
            [56.9303, 23.27927], [56.931495, 23.27887], [56.93247833, 23.27845]
        ];

        // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø±Ø§Ø¯Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ù†Ø·Ù‚Ø©
        const bounds = { n: 23.2810, s: 23.2780, e: 56.9330, w: 56.9250 };
        let score = 0;

        function startApp() {
            const splash = document.getElementById('splash');
            splash.style.opacity = '0';
            setTimeout(() => {
                splash.style.display = 'none';
                initAR();
                startGPS();
            }, 500);
            
            // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¨Ø¹Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¨Ø§Ø´Ø±Ø©
            speak("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù…Ø´Ù‰ Ø§Ù„Ù‡Ø¬Ø±. Ø§ØªØ¨Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ø°Ù‡Ø¨.");
        }

        function initAR() {
            const scene = document.querySelector('a-scene');
            
            trackCoordinates.forEach((coord, i) => {
                // Ø±Ø³Ù… Ù†Ù‚Ø·Ø© ÙƒÙ„ 3 Ù†Ù‚Ø§Ø· Ù„ØªØ®ÙÙŠÙ Ø§Ù„Ø­Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„
                if (i % 3 !== 0 && i !== trackCoordinates.length - 1) return;
                
                const lng = coord[0];
                const lat = coord[1];

                // Ù†Ù‚Ø·Ø© Ø§Ù„Ù…Ø³Ø§Ø± (Ø¨ÙŠØ¶Ø§Ø¡)
                const dot = document.createElement('a-entity');
                dot.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
                dot.innerHTML = `<a-sphere radius="0.5" color="white" material="opacity: 0.8; shader: flat"></a-sphere>`;
                scene.appendChild(dot);

                // Ø§Ù„Ø°Ù‡Ø¨ (ÙƒÙ„ 10 Ù†Ù‚Ø§Ø·)
                if (i % 10 === 0) {
                    const coin = document.createElement('a-entity');
                    coin.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
                    coin.innerHTML = `<a-octahedron radius="0.6" position="0 1 0" color="#FFD700" 
                        animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
                        material="emissive: #FFD700; emissiveIntensity: 0.5"></a-octahedron>`;
                    
                    coin.addEventListener('click', () => {
                        if(coin.getAttribute('visible') !== 'false') {
                            coin.setAttribute('visible', 'false');
                            score += 50;
                            document.querySelector('.hud-box').innerHTML = 'Ø§Ù„Ù†Ù‚Ø§Ø·: ' + score;
                            speak("Ù…Ù…ØªØ§Ø²");
                        }
                    });
                    scene.appendChild(coin);
                }
            });
        }

        function startGPS() {
            navigator.geolocation.watchPosition(pos => {
                const lat = pos.coords.latitude;
                const lng = pos.coords.longitude;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¯Ø§Ø±
                const y = ((bounds.n - lat) / (bounds.n - bounds.s)) * 100;
                const x = ((lng - bounds.w) / (bounds.e - bounds.w)) * 100;
                
                const dot = document.getElementById('radar-dot');
                // ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ù†Ù‚Ø·Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©
                dot.style.top = Math.min(Math.max(y, 5), 95) + '%';
                dot.style.left = Math.min(Math.max(x, 5), 95) + '%';

            }, null, { enableHighAccuracy: true });
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'ar-SA';
                window.speechSynthesis.speak(u);
            }
        }
        
        // Ø¥ØµÙ„Ø§Ø­ Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø©
        window.addEventListener('resize', () => {
            const scene = document.querySelector('a-scene');
            if(scene) scene.resize();
        });
    </script>
</body>
</html>
